<!DOCTYPE html>
<html
    lang="ko"
    xmlns:th="http://www.thymeleaf.org"
    xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
<head>
    <meta charset="UTF-8" />
    <title>[회원가입]</title>
    <link rel="stylesheet" href="https://bootswatch.com/5/cosmo/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
    </style>
</head>
<body>
    <div th:replace="~{header :: header}"></div>
        <div th:replace="~{menu :: menu}"></div>
    <main class="container my-5">
        <div class="row justify-content-center">
            <div class="col-lg-6">
                <h1 class="text-center mb-4">[회원가입]</h1>
                <form action="#" th:action="@{/member/join}" method="post">
                    
                    <!-- 아이디 -->
                    <label for="memberId" class="form-label">아이디</label>
                    <div class="input-group mb-3">
                        <input type="text" class="form-control" id="memberId" name="memberId" placeholder="아이디 (4~10자)" required readonly />
                        <button class="btn btn-outline-secondary" type="button" id="checkIdBtn">중복 확인</button>
                    </div>
                    <div id="idCheckMessage" class="form-text mb-2"></div>

                    <!-- 비밀번호 -->
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="memberPassword" name="memberPassword" placeholder="비밀번호" required />
                        <label for="memberPassword">비밀번호</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="confirmPassword" name="confirmPassword" placeholder="비밀번호 확인" required />
                        <label for="confirmPassword">비밀번호 확인</label>
                    </div>
                    <div id="passwordCheckMessage" class="form-text mb-2"></div>

                    <!-- 이름 -->
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="memberName" name="memberName" placeholder="이름" required />
                        <label for="memberName">이름</label>
                    </div>

                    <!-- 이메일 -->
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="email" name="email" placeholder="이메일" required />
                        <label for="email">이메일</label>
                    </div>

                    <!-- 전화번호 -->
                    <div class="form-floating mb-3">
                        <input type="tel" class="form-control" id="phone" name="phone" placeholder="전화번호" required />
                        <label for="phone">전화번호</label>
                    </div>

                    <!-- 주소 -->
                    <div class="form-floating mb-3">
                        <input type="text" class="form-control" id="address" name="address" placeholder="주소" required />
                        <label for="address">주소</label>
                    </div>

                    <!-- 버튼 -->
                    <div class="d-grid gap-2">
                        <button class="btn btn-primary btn-lg" type="submit">가입</button>
                        <button class="btn btn-secondary btn-lg" type="reset">다시 쓰기</button>
                    </div>
                </form>
            </div>
        </div>
    </main>

    <div th:replace="~{footer :: footer}"></div>

    <script>
        const memberId = document.getElementById('memberId');
        const checkIdBtn = document.getElementById('checkIdBtn');

        checkIdBtn.addEventListener('click', () => {
            window.open('/member/checkIdPopup', 'checkIdPopup', 'width=400,height=300');
        });

        // 팝업에서 아이디가 선택되면 이 함수가 호출됨
        window.setMemberId = function(id) {
            memberId.value = id;
            memberId.readOnly = true;
            document.getElementById('idCheckMessage').textContent = '사용 가능한 아이디입니다.';
            document.getElementById('idCheckMessage').style.color = 'green';
        }

        // 전화번호 자동 하이픈
        const phoneInput = document.getElementById('phone');
        phoneInput.addEventListener('input', (e) => {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length > 11) {
                value = value.substring(0, 11);
            }
            if (value.length > 3 && value.length <= 7) {
                value = value.replace(/(\d{3})(\d+)/, '$1-$2');
            } else if (value.length > 7) {
                value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
            }
            e.target.value = value;
        });

        // 비밀번호 유효성 검사
        const passwordInput = document.getElementById('memberPassword');
        const passwordCheckMessage = document.createElement('div');
        passwordCheckMessage.classList.add('form-text', 'mb-2');
        passwordInput.parentNode.insertBefore(passwordCheckMessage, passwordInput.nextSibling);

        passwordInput.addEventListener('input', (e) => {
            if (e.target.value.length > 0 && e.target.value.length < 4) {
                passwordCheckMessage.textContent = '비밀번호는 4자 이상이어야 합니다.';
                passwordCheckMessage.style.color = 'red';
            } else {
                passwordCheckMessage.textContent = '';
            }
            checkPasswords();
        });

        // 비밀번호 확인 실시간 체크
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const passwordMatchMessage = document.getElementById('passwordCheckMessage');

        confirmPasswordInput.addEventListener('input', checkPasswords);

        function checkPasswords() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (confirmPassword.length > 0 && password !== confirmPassword) {
                passwordMatchMessage.textContent = '비밀번호가 일치하지 않습니다.';
                passwordMatchMessage.style.color = 'red';
            } else if (password === confirmPassword && password.length >= 4) {
                passwordMatchMessage.textContent = '비밀번호가 일치합니다.';
                passwordMatchMessage.style.color = 'green';
            } else if (password.length < 4 && password.length > 0) {
                passwordMatchMessage.textContent = '비밀번호는 4자 이상이어야 합니다.';
                passwordMatchMessage.style.color = 'red';
            }
            else {
                passwordMatchMessage.textContent = '';
            }
        }
    </script>
</body>
</html>
